################################################################################
#   Build the code onlinux with GCC 14
#   Run the tests
#   Install
#   Upload artifact
################################################################################
name: Build-Ubuntu

on: [workflow_dispatch]


jobs:
  build:
    name: BuildTestInstall
    runs-on: ubuntu-24.04
    steps:
      # Clone the repo
      - name: Check out repository code
        uses: actions/checkout@v4

      #
      # Run cmake configure
      #
      - name: Running cmake configure ...
        env:
          CC: "gcc-14"
          CXX: "g++-14"
        run: |
            cmake \
                -B ./build \
                -G Ninja \
                -DCMAKE_TOOLCHAIN_FILE=$VCPKG_INSTALLATION_ROOT/scripts/buildsystems/vcpkg.cmake \
                -DCMAKE_BUILD_TYPE=Debug

      #
      # Build the code
      #
      - name: Running cmake build ...
        run: cmake --build ./build
      #
      # Run the test
      #
      - name: Running tests ...
        run: ctest --test-dir ./build
      #
      # Install
      #
      - name: Running cmake install ...
        run: cmake --install ./build --prefix ./install
      #
      # Upload artifact
      #
      - uses: actions/upload-artifact@v4
        with:
          name: install-ubuntu
          path: ./install

      - run: echo "This job's status is ${{ job.status }}."
